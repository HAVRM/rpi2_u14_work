<!DOCUTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0.1 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <title>メモリーチェック</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/1.0.2/Chart.min.js"></script>
 </head>
<body>
<br>　　　　　cpu<br>
<canvas id="cpu" height="200" width="200"></canvas>
<br><br>　　　　memory<br>
<canvas id="memory" height="200" width="200"></canvas>
<br><br>thermal [℃]<br>
<div id="thermal"></div>
 <script type="text/javascript">

document.getElementById("thermal").innerHTML="0.000"
var meminitdata = [
 {
  value: 10,
  color:"#F7464A",
  highlight: "#FF5A5E",
  label: "Used"
 },
 {
  value: 10,
  color: "#46BFBD",
  highlight: "#5AD3D1",
  label: "Free"
 }
];

var cpuinitdata = [
 {
  value: 10,
  color:"#F7464A",
  highlight: "#FF5A5E",
  label: "user Used"
 },
 {
  value: 10,
  color:"#FFD700",
  highlight: "#FFFF00",
  label: "system Used"
 },
 {
  value: 10,
  color: "#46BFBD",
  highlight: "#5AD3D1",
  label: "idle"
 }
];
var cpuChart = new Chart(document.getElementById("cpu").getContext("2d")).Doughnut(cpuinitdata,{animation:false});
var memChart = new Chart(document.getElementById("memory").getContext("2d")).Doughnut(meminitdata,{animation:false});

function loadFile(fileName){
   httpObj = new XMLHttpRequest();
   httpObj.open('GET',fileName+"?"+(new Date()).getTime(),true);
   // ?以降はキャッシュされたファイルではなく、毎回読み込むためのもの
   httpObj.send(null);
   var memdata=[];
   httpObj.onreadystatechange = function(){
      if ( (httpObj.readyState == 4) && (httpObj.status == 200) ){
         txtdata=httpObj.responseText.split("/");
         for (var i=0; i<2; i++){
           memChart.segments[i].value=parseInt(txtdata[i+1],10);
         }
         memChart.update();
         document.getElementById("thermal").innerHTML=txtdata[3];
         for (var i=0; i<3; i++){
           cpuChart.segments[i].value=parseInt(txtdata[i+5],10);
         }
         cpuChart.update();
      }
   }
}

setInterval("loadFile('rpi_data.cgi')",500);

</script>

<!--<input type="button" value="ファイル読み込み" 
       onClick="loadFile('test.cgi')" />-->
</body>
</html>

